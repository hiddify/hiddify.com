
<div dir="rtl" markdown=1>
# استفاده از CDN کلادفلر
کلادفلر بزرگترین ارائه دهنده سرویس‌های CDN است که دارای سرویس‌های متعددی است که می‌توان با کمک از این سرویس‌ها، محدودیت‌های اینترنت را دور زد. در ادامه مهم‌ترین سرویس‌ها، توضیح داده می‌شوند.

## سرویس سایت یا دامنه
  به این معنی است که شما از سرور خود در پشت یک ارائه دهنده CDN استفاده می کنید. به عبارت دیگر شما دامنه (ساب دامنه) خود را در یک ارائه دهنده CDN ثبت می کنید و سپس آن را پروکسی می کنید. در اینجا ما نحوه ثبت در کلادفلر را بحث می‌کنیم. اگر می‌خواهید آموزش استفاده از CDN GCore بر روی دامنه ثبت شده در Cloudflare را مشاهده کنید [این لینک](/manager/wiki/%D8%A2%D9%85%D9%88%D8%B2%D8%B4-%D8%A7%D8%B3%D8%AA%D9%81%D8%A7%D8%AF%D9%87-%D8%A7%D8%B2-CDN-GCore-%D8%A8%D8%B1-%D8%B1%D9%88%DB%8C-%D8%AF%D8%A7%D9%85%D9%86%D9%87-%D8%AB%D8%A8%D8%AA-%D8%B4%D8%AF%D9%87-%D8%AF%D8%B1-Cloudflare) را ببینید.




### ثبت دامنه دایرکت خریداری شده در کلادفلر
ابتدا با استفاده از [این لینک](https://dash.cloudflare.com/signup) ثبت نام می کنید.

![Screenshot_20230225_102424](https://user-images.githubusercontent.com/125398461/221563866-d520a39d-15c8-4f88-a756-90e5e08c074a.png)

پس از ایجاد پروفایل به آن وارد شوید. در اینجا دامنه خود را باید اضافه نمایید. برای این کار روی دکمه Add a site بزنیدو دامنه خود را اضافه نمایید.

![Screenshot_20230227_160604](https://user-images.githubusercontent.com/125398461/221566504-5ecf714b-940d-4fd5-bc54-be8c37b7c292.png)


در مرحله بعد پلن مورد نظر خود را انتخاب نمایید. برای این کار پلن رایگان کافیست. بنابراین مطابق با عکس انتخاب می نمایید.

![Screenshot_20230227_161426](https://user-images.githubusercontent.com/125398461/221567803-26850724-1bc8-480a-8c6f-29b32a6fcfa6.png)

در مرحله بعد مطابق با شکل next می کنیم.

![Screenshot_20230227_162027](https://user-images.githubusercontent.com/125398461/222444475-5596de54-3e7f-4fae-a0f0-94c046a21969.png)


در مرحله آخر سرورهای DNS داده شده را در تنظیمات دامنه خود قرار دهید.

![Screenshot_20230227_162410](https://user-images.githubusercontent.com/125398461/221569269-1f4027c7-5815-4dea-876e-326dc0645fe1.png)


مقداری ثبت نمایید تا تنظیمات دامنه ثبت گردد. بعد از آن دامنه در سرور کلادفلر اکتیو می گردد.

![Screenshot_20230227_163943](https://user-images.githubusercontent.com/125398461/221572305-50e819ea-0fa4-4548-8851-aab91b797f57.png)

حال باید به قسمت ثبت رکوردهای DNS بروید.

![Screenshot_20230227_164245](https://user-images.githubusercontent.com/125398461/222436778-f80de97b-7d66-4621-8be3-b856fc4e2c75.png)

در این حالت برای ثبت رکوردهای مرتبط با آیپی ورژن ۴ مطابق شکل عمل نمایید.

![Screenshot_20230227_164507](https://user-images.githubusercontent.com/125398461/222444012-2fa4a2c2-ff89-493e-b92c-01a26d7788b7.png)


پس از کلیک روی Add record مشخصات ساب دامین مورد نظر را با درج آیپی سرور ثبت نمایید. دقت شود که برای دامین دایرکت باید پروکسی خاموش گردد.

![Screenshot_20230302_165426](https://user-images.githubusercontent.com/125398461/222443477-e8b56c36-7631-44b3-8b8d-c03e43d6ce84.png)

در صورتی که نیاز باشد می توانید TTL را از حالت اتوماتیک تغییر دهید. هر چه این مقدار کمتر باشد؛ رکوردهای DNS کش شده در سیستم کاربر زودتر رفرش می گردند.

برای ثبت رکوردهای مرتبط با آیپی ورژن ۶ سرور مطابق با شکل عمل نمایید.

![Screenshot_20230302_171704](https://user-images.githubusercontent.com/125398461/222447422-45f9da15-5ce9-4a27-97c8-bb1395ea5cd8.png)


تمامی موارد ذکر شده در خصوص آیپی ورژن ۴ در این مورد نیز صدق می کند. تنها تفاوت نوع رکورد است که AAAA می باشد.



### ثبت دامنه CDN در کلادفلر
این دامنه در پشت سرورهای کلادفلر ثبت یا به اصطلاح پروکسی می شود.

بنابراین پس از اینکه طبق مراحل گفته شده بالا؛ دامنه شما در سایت اکتیو شد؛ می بایست به قسمت DNS بروید و رکورد مورد نظر خود را ثبت نمایید.
این رکورد برای آیپی ورژن ۴ از نوع A و برای آیپی ورژن ۶ از نوع AAAA می باشد.
تنها تفاوت با مرحله قبل این است که حتما بایستی پروکسی را روشن نمایید.

![Screenshot_20230227_164553](https://user-images.githubusercontent.com/125398461/222454021-ab8b0162-c608-478c-937c-05e384212c25.png)

## تست ثبت دامنه CDN
زمانی که این دامنه را با استفاده از ابزارهای مختلف از جمله ping, nslookup, dig تست می کنید؛ در جواب یکی از آیپی هایی که کلادفلر به صورت رندوم در آن لحظه به دامنه شما اختصاص داده است بر می گردد و دیگر خبری از آیپی شما نیست. این کار یه سطح از امنیت را برای سرور شما برقرار می کند.

توجه شود که این آیپی در بازه های زمانی مختلف تغییر می کند و ثابت نیست.

گاها اتفاق می افتد که آیپی اختصاص داده شده توسط کلادفلر در ایران مسدود یا دچار اختلال شده است که در این خصوص باید از راه کارهای دور زدن این نوع فیلترینگ استفاده نمود. 

## سرویس سرتیفیکت در کلادفلر

TLS الگوریتمی است که تمام ترافیک اینترنت را رمزگذاری می کند و به کاربر کمک می کند تا به صورت آنلاین ایمن بماند.
 
به بیان دقیق تر؛ TLS ارتباط بین کلاینت و سرور را در بستر وب رمزگذاری می کند که از مجموعه ای از الگوریتم های رمزنگاری مثل alpn, uTLS, allowInsecure استفاده می کند.

 سرتیفیکت هایی که به دامین ها تخصیص داده می شوند نیز بر مبنای پروتکل TLS هستند.

برای این کار در سایت کلادفلر به قسمت SSL/TLS بروید و حالت سرتیفیکت را بر روی Full قرار دهید.

![Screenshot_20230425_070544](https://user-images.githubusercontent.com/125398461/234169021-7201c012-82fb-4511-a7a8-8337e02a5b12.png)


همچنین جهت افزایش امنیت ارتباط گزینه SSL/TLS Recommender را فعال کنید. این گزینه ارتباط را چک می کند و در صورت امکان ارتقاء نسخه TLS به شما پیشنهادات امنیتی می دهد.


سپس به منوی Network بروید. اینجا باید چک کنید گزینه های QUIC و gRPC و WebSockets فعال باشند.



![Screenshot_20230306_095532](https://user-images.githubusercontent.com/125398461/223042141-c2456322-7cac-44be-be9c-044a307eeb52.png)
0230306_095509](https://user-images.githubusercontent.com/125398461/223041843-7b441805-4aab-4547-b318-7dbbda4cc893.png)

![Screenshot_20230306_095532](https://user-images.githubusercontent.com/125398461/223042286-e597f169-001e-40a5-b0e8-d34d1b110eab.png)

## چک کردن وضعیت امنیتی ترافیک دامنه CDN 

برای این کار در بخش SSL/TLS سایت کلادفلر بروید. نموداری برای ترافیک عبوری نمایش داده می شود که هر چه ترافیک بیشتری بر مبنای TLS های ورژن بالاتر عبور کرده باشد؛ امنیت ارتباط بالاتر بوده است. ترافیک های http بدون استفاده از رمزنگاری TLS عبور می کنند.

![Screenshot_20230306_095444](https://user-images.githubusercontent.com/125398461/223042939-897b7ec0-9700-4bec-8e28-6d8f961657b6.png)

## سرویس ورکر کلادفلر
برای مشاهده جزییات مربوط به این سرویس، این [مقاله](/manager/wiki/%D9%86%D8%AD%D9%88%D9%87-%D8%AA%D9%86%D8%B8%DB%8C%D9%85-%D9%88-%D8%A7%D8%B3%D8%AA%D9%81%D8%A7%D8%AF%D9%87-%D8%A7%D8%B2-%D9%88%D8%B1%DA%A9%D8%B1%D8%B2) را مطالعه کنید.

## سرویس دامین فرانتینگ
برای مشاهده جزییات مربوط به این سرویس، این [مقاله](/manager/wiki/%D8%A7%D8%B3%D8%AA%D9%81%D8%A7%D8%AF%D9%87-%D8%A7%D8%B2-%D8%AF%D8%A7%D9%85%DB%8C%D9%86-%D9%81%D8%B1%D8%A7%D9%86%D8%AA%DB%8C%D9%86%DA%AF) را مطالعه کنید.

این سرویس فعلا در کلادفلر غیرفعال شده است.

## سرویس gRPC
این سرویس در سال ۲۰۱۵ توسط گوگل معرفی شد و بر پایه  TLS و HTTP/2 می‌باشد و به دلیل اینکه سایز بسته‌های ان کوچک تر است، پهنای باند کمتری نیاز دارد و بنابراین سریع‌تر است. این سرویس در کلادفلر نیز فعال است و با خیلی از سرویس‌های دیگر آن مطابقت دارد. بنابراین می‌توان روی سرویس دامنه نیز آن را فعال کنید و از این قابلیت برای دور زدن فیلترینگ استفاده کنید.

- برای این کار به بخش `Network` بروید و سپس گزینه `gRPC` را فعال کنید.

![](https://user-images.githubusercontent.com/125398461/223042141-c2456322-7cac-44be-be9c-044a307eeb52.png)

- بعد از آن امکان ارسال بسته‌های `gRPC` از کلاینت به سمت کلادفلر فراهم می‌شود. پس از رسیدن بسته‌ها به کلادفلر، آن‌ها به سمت مقصد اصلی که سرور شماست، هدایت می‌شوند.

## سرویس WebSocket
یکی دیگر از سرویس‌های کلادفلر، `WebSocket` است که امکان ارتباط پایدار بین کلاینت و سرور اصلی را فراهم می کند. در این حالت کلاینت و سرور می‌توانند بدون نیاز به برقراری مجدد ارتباط، اطلاعات را رد و بدل می‌کنند و ارتباط پایداری خواهند داشت. از این سرویس نیز می‌توان برای دور زدن فیلترینگ استفاده کرد. 

- برای این کار به بخش `Network` بروید و سپس گزینه `WebSockets` را فعال کنید.

![](https://user-images.githubusercontent.com/125398461/223042141-c2456322-7cac-44be-be9c-044a307eeb52.png)

- بعد از آن امکان ارسال بسته‌های `WebSocket` از کلاینت به سمت کلادفلر فراهم می‌شود. پس از رسیدن بسته‌ها به کلادفلر، آن‌ها به سمت مقصد اصلی که سرور شماست، هدایت می‌شوند.

## سرویس QUIC
این سرویس بر مبنای HTTP/3 پایه‌گذاری شده است و با TLS1.3 کار می‌کند. به همین دلیل خیلی سریع است چون هندشیک آن نسبت به TCP خیلی سریع‌تر است. 

<div align=center markdown=1>
<img width="60%" alt="http-request-over-quic" src="https://github.com/hiddify/hiddify-config/assets/125398461/5793c28e-7785-4ea5-998d-9695cc11b341" />

</div>

- برای این کار به بخش `Network` بروید و سپس گزینه `HTTP/3 (with QUIC)` را فعال کنید.

![QUIC](https://user-images.githubusercontent.com/125398461/223041843-7b441805-4aab-4547-b318-7dbbda4cc893.png)